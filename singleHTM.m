function T = singleHTM(l, xi, L, r)
% The function computes the HTM of the single section in joint-space
% varirbles (length-changes).
% 
% Implementation is inspired from:
%   * Godage, Isuru S., Thrishantha Nanayakkara, and Darwin G. Caldwell. 
%     "Locomotion with continuum limbs." In 2012 IEEE/RSJ International 
%     Conference on Intelligent Robots and Systems, pp. 293-298. IEEE, 2012.
%
% Inputs:
%   l   : length change [2x1] (m)
%   xi  : position on the backbone [constant] {0 1}
%   L   : length of the backbone of the continuum arm [constant] (m)
%   r   : radial offset of the PMA from the backbone [constant] (m)
% 
% Outputs:
%   T   : HTM at the 'xi'


T = [(((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 8 * (l(1) + l(2)) ^ 2 - 42 * (l(1) + l(2)) ^ 2 * xi ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2 * r ^ 2 + 945 * (l(1) + l(2)) ^ 2 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 4 - 8505 * (l(1) + l(2)) ^ 2 * xi ^ 2 * r ^ 6 + 17010 * r ^ 8) / r ^ 8) / 0.17010e5 sqrt(0.3e1) * (-l(2) + l(1)) * (xi ^ 2) * (l(1) + l(2)) * (-((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 2) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 6)) / (r ^ 8) / 0.6e1 xi * (l(1) + l(2)) * ((r ^ 8) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 6) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 4) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 2) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4)) / (r ^ 9) (l(1) + l(2)) * L * (-((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 2) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 6)) * (xi ^ 2) / (r ^ 7) / 0.2e1; sqrt(0.3e1) * (-l(2) + l(1)) * (xi ^ 2) * (l(1) + l(2)) * (-((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 2) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 6)) / (r ^ 8) / 0.6e1 (((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 8 * (-l(2) + l(1)) ^ 2 + (-42 * r ^ 2 * l(1) ^ 6 + 84 * r ^ 2 * l(1) ^ 3 * l(2) ^ 3 - 42 * r ^ 2 * l(2) ^ 6) * xi ^ 6 + 945 * (-l(2) + l(1)) ^ 2 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 4 - 8505 * (-l(2) + l(1)) ^ 2 * xi ^ 2 * r ^ 6 + 51030 * r ^ 8) / r ^ 8) / 0.51030e5 -sqrt(0.3e1) * (-l(2) + l(1)) * xi * ((r ^ 8) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 6) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 4) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 2) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4)) / (r ^ 9) / 0.3e1 -L * (-((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 2) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 6)) * (xi ^ 2) * (-l(2) + l(1)) * sqrt(0.3e1) / (r ^ 7) / 0.6e1; -xi * (l(1) + l(2)) * ((r ^ 8) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 6) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 4) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 2) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4)) / (r ^ 9) sqrt(0.3e1) * (-l(2) + l(1)) * xi * ((r ^ 8) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 6) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 4) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 2) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4)) / (r ^ 9) / 0.3e1 ((-4 * xi ^ 10 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5 + 270 * xi ^ 8 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4 * r ^ 2 - 11340 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6 * r ^ 4 + 255150 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2 * r ^ 6 - 2296350 * xi ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 8 + 3444525 * r ^ 10) / r ^ 10) / 0.3444525e7 L * xi * ((r ^ 8) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 6) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 4) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 2) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4)) / (r ^ 8); 0 0 0 1;];

end