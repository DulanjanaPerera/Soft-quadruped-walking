function T = singleHTM(l, xi, L, r)
% The function computes the HTM of the single section in joint-space
% varirbles (length-changes).
% 
% Implementation is inspired from:
%   * Godage, Isuru S., Thrishantha Nanayakkara, and Darwin G. Caldwell. 
%     "Locomotion with continuum limbs." In 2012 IEEE/RSJ International 
%     Conference on Intelligent Robots and Systems, pp. 293-298. IEEE, 2012.
%
% Inputs:
%   l   : length change [2x1] (m)
%   xi  : position on the backbone [constant] {0 1}
%   L   : length of the backbone of the continuum arm [constant] (m)
%   r   : radial offset of the PMA from the backbone [constant] (m)
% 
% Outputs:
%   T   : HTM at the 'xi'


T = [((-2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4 * xi ^ 10 * (l(1) + l(2)) ^ 2 + 135 * (l(1) + l(2)) ^ 2 * xi ^ 8 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * r ^ 2 - 5670 * (l(1) + l(2)) ^ 2 * xi ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2 * r ^ 4 + 127575 * (l(1) + l(2)) ^ 2 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 6 - 1148175 * (l(1) + l(2)) ^ 2 * xi ^ 2 * r ^ 8 + 2296350 * r ^ 10) / r ^ 10) / 0.2296350e7 (xi ^ 2) * sqrt(0.3e1) * (-l(2) + l(1)) * (l(1) + l(2)) * (0.2e1 / 0.1148175e7 * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (xi ^ 8) - (r ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 8)) / (r ^ 10) / 0.6e1 xi * ((r ^ 10) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 8) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 6) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 4) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (r ^ 2) - 0.4e1 / 0.37889775e8 * (xi ^ 10) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5)) * (l(1) + l(2)) / (r ^ 11) (l(1) + l(2)) * (0.2e1 / 0.1148175e7 * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (xi ^ 8) - (r ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 8)) * (xi ^ 2) * L / (r ^ 9) / 0.2e1; (xi ^ 2) * sqrt(0.3e1) * (-l(2) + l(1)) * (l(1) + l(2)) * (0.2e1 / 0.1148175e7 * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (xi ^ 8) - (r ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 8)) / (r ^ 10) / 0.6e1 ((-2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4 * xi ^ 10 * (-l(2) + l(1)) ^ 2 + 135 * (-l(2) + l(1)) ^ 2 * xi ^ 8 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * r ^ 2 - 5670 * (-l(2) + l(1)) ^ 2 * xi ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2 * r ^ 4 + 127575 * (-l(2) + l(1)) ^ 2 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 6 - 1148175 * (-l(2) + l(1)) ^ 2 * xi ^ 2 * r ^ 8 + 6889050 * r ^ 10) / r ^ 10) / 0.6889050e7 -xi * sqrt(0.3e1) * ((r ^ 10) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 8) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 6) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 4) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (r ^ 2) - 0.4e1 / 0.37889775e8 * (xi ^ 10) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5)) * (-l(2) + l(1)) / (r ^ 11) / 0.3e1 -(-l(2) + l(1)) * (xi ^ 2) * (0.2e1 / 0.1148175e7 * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (xi ^ 8) - (r ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * xi ^ 6) / 0.8505e4 + 0.2e1 / 0.405e3 * (r ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (xi ^ 4) - (r ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * xi ^ 2) / 0.9e1 + (r ^ 8)) * L * sqrt(0.3e1) / (r ^ 9) / 0.6e1; -xi * ((r ^ 10) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 8) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 6) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 4) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (r ^ 2) - 0.4e1 / 0.37889775e8 * (xi ^ 10) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5)) * (l(1) + l(2)) / (r ^ 11) xi * sqrt(0.3e1) * ((r ^ 10) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 8) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 6) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 4) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (r ^ 2) - 0.4e1 / 0.37889775e8 * (xi ^ 10) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5)) * (-l(2) + l(1)) / (r ^ 11) / 0.3e1 ((4 * xi ^ 12 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 6 - 396 * xi ^ 10 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5 * r ^ 2 + 26730 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4 * xi ^ 8 * r ^ 4 - 1122660 * xi ^ 6 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3 * r ^ 6 + 25259850 * xi ^ 4 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2 * r ^ 8 - 227338650 * xi ^ 2 * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * r ^ 10 + 341007975 * r ^ 12) / r ^ 12) / 0.341007975e9 ((r ^ 10) - 0.2e1 / 0.9e1 * (xi ^ 2) * (l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) * (r ^ 8) + 0.2e1 / 0.135e3 * (xi ^ 4) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 2) * (r ^ 6) - 0.4e1 / 0.8505e4 * (xi ^ 6) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 3) * (r ^ 4) + 0.2e1 / 0.229635e6 * (xi ^ 8) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 4) * (r ^ 2) - 0.4e1 / 0.37889775e8 * (xi ^ 10) * ((l(1) ^ 2 + l(1) * l(2) + l(2) ^ 2) ^ 5)) * xi * L / (r ^ 10); 0 0 0 1;];

end